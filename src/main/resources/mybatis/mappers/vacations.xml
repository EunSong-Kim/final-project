<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="com.last.mapper.VacationMapper">
	<select id="getItems" resultType="VacationItem">
		select 
			item_code as code,
			item_name as name,
			year_vacation_used as used,
			item_used as deleted,
			salary_payed as payed,
			note as note
		from
			vacation_items
		order by
			item_code asc
	</select>

	<select id="getItemByCode" parameterType="int" resultType="VacationItem">
		select 
			item_code as code,
			item_name as name,
			year_vacation_used as used,
			item_used as deleted,
			salary_payed as payed,
			note as note
		from
			vacation_items
		where
			item_code = #{value}
	</select>
	
	<!-- 
		void insertPost()
	 -->
	 <insert id="insertItem" parameterType="VacationItem">
	 	insert into vacation_items
	 		(item_code, item_name, year_vacation_used, item_used, salary_payed)
	 	values
	 		(#{code}, #{name}, #{used}, #{deleted}, #{payed})
	 </insert>
	 
	<update id="updateItem" parameterType="VacationItem">
		update
			vacation_items
		set
			item_name = #{name},
			year_vacation_used = #{used},
			item_used = #{deleted},
			salary_payed = #{payed}
		where
			item_code = #{code}
	</update>	 
	
	<select id="getUsedVacations" parameterType="hashmap" resultType="VacationRequestDto">
		select
	   		 B.employee_no as empNo,
	  		  B.employee_name as empName,
	  		  C.position_name as positionName,
	  		  D.dept_name as deptName,
	  		  A.days as days,
	 		  E.item_name as itemName,
	 		  to_char(A.request_date, 'yyyy-MM-dd') as requestDate,
	  		  to_char(A.start_date, 'yyyy-MM-dd') as startDate,
	    	  to_char(A.end_date, 'yyyy_MM-dd') as endDate
		from
			 vacation_request_histories A, employees B, positions C, departments D, vacation_items E
		where 
			A.item_code = E.item_code
	     	 and A.employee_no = B.employee_no
	     	 and B.dept_no = D.dept_no
	     	 and B.position_no = C.position_no
	     	 and A.request_status = '승인'
	    	 and to_char(A.end_date, 'yyyy') = #{year}	
              <if test="empNo != null"> and A.employee_no = #{empNo}</if>
              <if test="empName != null"> and B.employee_name = #{empName}</if>
              <if test="dept != null"> and D.dept_name = #{dept}</if>
	    order by 
            A.end_date desc
	</select>

</mapper>